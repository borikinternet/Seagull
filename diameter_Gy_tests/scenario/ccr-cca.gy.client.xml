<?xml version="1.0" encoding="ISO-8859-1" ?>
<!--

  This program is free software; you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation; either version 2 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

 (c)Copyright 2006 Hewlett-Packard Development Company, LP.

-->
<scenario>

    <counter>
        <counterdef name="HbH-counter" init="1000"></counterdef>
        <counterdef name="EtE-counter" init="2000"></counterdef>
        <counterdef name="session-counter" init="0"></counterdef>
        <counterdef name="charging-id-counter" init="0"></counterdef>
    </counter>

    <init>
        <send channel="channel-1">
            <command name="CER">
                <avp name="Origin-Host" value="seagull.mydomain.com"></avp>
                <avp name="Origin-Realm" value="ExampleRealm"></avp>
                <avp name="Host-IP-Address" value="0x00010adf487c"></avp>
                <avp name="Vendor-Id" value="10415"></avp>
                <avp name="Product-Name" value="SeagullTesting"></avp>
                <avp name="Supported-Vendor-Id" value="10415"></avp>
                <avp name="Vendor-Specific-Application-Id">
                    <avp name="Vendor-Id" value="10415"></avp>
                    <avp name="Auth-Application-Id" value="4"></avp>
                </avp>
                <avp name="Vendor-Specific-Application-Id">
                    <avp name="Vendor-Id" value="10415"></avp>
                    <avp name="Auth-Application-Id" value="16777238"></avp>
                </avp>
                <avp name="Firmware-Revision" value="1"></avp>
            </command>
        </send>

        <receive channel="channel-1">
            <command name="CEA">
                <avp name="Result-Code" value="2001"></avp>
            </command>
            <action>
                <check-value name="Result-Code" behaviour="error"></check-value>
            </action>
        </receive>
    </init>

    <!-- Traffic -->
    <traffic>
        <send channel="channel-1">
            <action>
                <!-- For each new call, increment the session-ID counter -->
                <inc-counter name="HbH-counter"></inc-counter>
                <inc-counter name="EtE-counter"></inc-counter>
                <inc-counter name="session-counter"></inc-counter>
                <inc-counter name="charging-id-counter"></inc-counter>
                <set-value name="HbH-id"
                           format="$(HbH-counter)"></set-value>
                <set-value name="EtE-id"
                           format="$(EtE-counter)"></set-value>
                <set-value name="Session-Id"
                           format="seagull.airlinq.net;1096298391;$(session-counter)"></set-value>
                <set-value name="3GPP-Charging-Id" format="0x$(charging-id-counter)"></set-value>
                <restore-from-external field="0" entity="Subscription-Id-Data" occurence="1">
                </restore-from-external>
                <restore-from-external field="1" entity="Subscription-Id-Data" occurence="2">
                </restore-from-external>
<!--                <restore-from-external field="2" entity="Framed-IP-Address"></restore-from-external>-->
                <restore-from-external field="3" entity="User-Equipment-Info-Value"></restore-from-external>
<!--                <restore-from-external field="4" entity="AN-GW-Address"></restore-from-external>-->
                <restore-from-external field="0" entity="User-Name" begin="0" end="12"></restore-from-external>
                <set-value name="Event-Timestamp" method="systime"
                           format="startoffset=2208988800"></set-value>
                <restore-from-external field="1" entity="3GPP-IMSI-MCC-MNC" begin="0" end="6"></restore-from-external>
                <restore-from-external field="2" entity="PDP-Address" begin="2" end="6"></restore-from-external>
            </action>
            <command name="CCR">
                <avp name="Session-Id" value="value_is_replaced"></avp>
                <avp name="Auth-Application-Id" value="16777238"></avp>
                <avp name="Origin-Host" value="seagull.airlinq.net"></avp>
                <avp name="Origin-Realm" value="airlinq.net"></avp>
                <avp name="Destination-Realm" value="epc.mnc020.mcc334.3gppnetwork.org"></avp>
                <avp name="CC-Request-Type" value="0x00000001"></avp> <!-- INITIAL REQUEST -->
                <avp name="CC-Request-Number" value="0"></avp>
                <avp name="User-Name" value="xxxxxxxxxxxx@wwwcorps-airlinq.itelcel.com"></avp>
                <avp name="Origin-State-Id" value="1646029647"></avp>
                <avp name="Event-Timestamp" value="0"></avp>
                <avp name="Subscription-Id">
                    <avp name="Subscription-Id-Type" value="0"></avp>
                    <avp name="Subscription-Id-Data" value="value_is_replaced_by_external_end_user_e164"></avp>
                </avp>
                <avp name="Subscription-Id">
                    <avp name="Subscription-Id-Type" value="1"></avp>
                    <avp name="Subscription-Id-Data" value="value_is_replaced_by_external_end_user_imsi"></avp>
                </avp>
                <avp name="Multiple-Services-Indicator" value="1"></avp>
<!--
                <avp name="Supported-Features">
                    <avp name="Vendor-Id" value="10415"></avp>
                    <avp name="Feature-List-ID" value="1"></avp>
                    <avp name="Feature-List" value="2"></avp>
                </avp>
-->
                <avp name="User-Equipment-Info">
                    <avp name="User-Equipment-Info-Type" value="0"></avp>
                    <avp name="User-Equipment-Info-Value" value="value_is_replaced_by_external_imeisv"></avp>
                </avp>
                <avp name="Service-Information">
                    <avp name="PS-Information">
                        <avp name="3GPP-Charging-Id" value="0x01c40162"></avp> <!-- TODO check value changes -->
                        <avp name="3GPP-PDP-Type" value="0"></avp>
                        <avp name="PDP-Address" value="0x000100000000"></avp> <!-- should be replaced by ue ip -->
                        <avp name="3GPP-GPRS-Negotiated-QoS-Profile" value="99-13921F7196FEFE74FAFFFF"></avp>
                        <avp name="SGSN-Address" value="0x0001c990c390"></avp>
                        <avp name="GGSN-Address" value="0x0001c85fa078"></avp>
                        <avp name="3GPP-IMSI-MCC-MNC" value="000000"></avp> <!-- should be replaced by imsi part -->
                        <avp name="3GPP-GGSN-MCC-MNC" value="334020"></avp>
                        <avp name="3GPP-NSAPI" value="5"></avp>
                        <avp name="Called-Station-Id" value="wwwcorps.itelcel.com"></avp>
                        <avp name="3GPP-Selection-Mode" value="0"></avp>
                        <avp name="3GPP-Charging-Characteristics" value="3200"></avp>
                        <avp name="3GPP-SGSN-MCC-MNC" value="334020"></avp>
                        <avp name="Charging-Rule-Base-Name" value="AQ_612"></avp>
                        <avp name="3GPP-User-Location-Info" value="0x0133042032d384a4"></avp>
                        <avp name="3GPP-RAT-Type" value="0x02"></avp>
                    </avp>
                </avp>
<!--
                <avp name="Framed-IP-Address" value="value_is_replaced_by_external_end_user_ip_address"></avp>
                <avp name="IP-CAN-Type" value="5"></avp>
                <avp name="RAT-Type" value="1000"></avp>
                <avp name="QoS-Information">
                    <avp name="APN-Aggregate-Max-Bitrate-UL" value="8640000"></avp>
                    <avp name="APN-Aggregate-Max-Bitrate-DL" value="31000000"></avp>
                </avp>
                <avp name="Default-EPS-Bearer-QoS">
                    <avp name="QoS-Class-Identifier" value="7"></avp>
                    <avp name="Allocation-Retention-Priority">
                        <avp name="Priority-Level" value="4"></avp>
                        <avp name="Pre-emption-Capability" value="1"></avp>
                        <avp name="Pre-emption-Vulnerability" value="0"></avp>
                    </avp>
                </avp>
                <avp name="3GPP-SGSN-MCC-MNC" value="334020"></avp>
                <avp name="AN-GW-Address" value="value_is_replaced_by_external_an_gw_address"></avp>
                <avp name="RAI" value="334020FFFEFF"></avp>
                <avp name="3GPP-User-Location-Info" value="0x0133042032d384a4"></avp>
                <avp name="3GPP-MS-TimeZone" value="0x4a20"></avp>
                <avp name="Called-Station-Id" value="wwwcorps.itelcel.com"></avp>
                <avp name="Bearer-Usage" value="0"></avp>
                <avp name="Online" value="1"></avp>
                <avp name="Offline" value="1"></avp>
                <avp name="Access-Network-Charging-Address" value="0x0001c85fa078"></avp>
                <avp name="Access-Network-Charging-Identifier-Gx">
                    <avp name="Access-Network-Charging-Identifier-Value" value="0"></avp>
                </avp>
-->
                <avp name="Route-Record" value="0001-diamproxy.r9mlscipgw05"></avp>
            </command>
            <action>
                <start-timer></start-timer>
                <store name="REQUEST_NUMBER" entity="CC-Request-Number"></store>
            </action>
        </send>

        <receive channel="channel-1">
            <action>
                <stop-timer></stop-timer>
            </action>
            <command name="CCA">
                <avp name="Result-Code" value="2001"></avp>
            </command>
            <action>
                <store name="ORIGIN_HOST" entity="Origin-Host"></store>
                <check-value name="Result-Code" behaviour="error"></check-value>
            </action>
        </receive>

        <wait-ms value="1000"></wait-ms>

        <send channel="channel-1">
            <action>
                <!-- For each new call, increment the session-ID counter -->
                <inc-counter name="HbH-counter"></inc-counter>
                <inc-counter name="EtE-counter"></inc-counter>
                <set-value name="HbH-id"
                           format="$(HbH-counter)"></set-value>
                <set-value name="EtE-id"
                           format="$(EtE-counter)"></set-value>
                <set-value name="Session-Id"
                           format="seagull.airlinq.net;1096298391;$(session-counter)"></set-value>
                <restore-from-external field="0" entity="Subscription-Id-Data" occurence="1"></restore-from-external>
                <restore-from-external field="1" entity="Subscription-Id-Data" occurence="2"></restore-from-external>
                <restore-from-external field="3" entity="User-Equipment-Info-Value"></restore-from-external>
                <restore name="ORIGIN_HOST" entity="Destination-Host"></restore>
                <restore-from-external field="0" entity="User-Name" begin="0" end="12"></restore-from-external>
                <set-value name="Event-Timestamp" method="systime"
                           format="startoffset=2208988800"></set-value>
                <restore-from-external field="2" entity="PDP-Address" begin="2" end="6"></restore-from-external>
                <restore-from-external field="1" entity="3GPP-IMSI-MCC-MNC" begin="0" end="6"></restore-from-external>
                <inc-var name="REQUEST_NUMBER"></inc-var>
                <restore name="REQUEST_NUMBER" entity="CC-Request-Number"></restore>
            </action>
            <command name="CCR">
                <avp name="Session-Id" value="value_is_replaced"></avp>
                <avp name="Auth-Application-Id" value="4"></avp>
                <avp name="Origin-Host" value="seagull.airlinq.net"></avp>
                <avp name="Origin-Realm" value="airlinq.net"></avp>
                <avp name="Destination-Realm" value="epc.mnc020.mcc334.3gppnetwork.org"></avp>
                <avp name="Destination-Host" value="value_is replaced_by_origin_host_from_reply"></avp>
                <avp name="CC-Request-Type" value="0x00000002"></avp> <!-- UPDATE REQUEST -->
                <avp name="CC-Request-Number" value="0"></avp>
                <avp name="Service-Context-Id" value="32251@3gpp.org"></avp>
                <avp name="User-Name" value="xxxxxxxxxxxx@wwwcorps-airlinq.itelcel.com"></avp>
                <avp name="Origin-State-Id" value="1646029647"></avp>
                <avp name="Event-Timestamp" value="0"></avp>
                <avp name="Subscription-Id">
                    <avp name="Subscription-Id-Type" value="0"></avp>
                    <avp name="Subscription-Id-Data" value="value_is_replaced_by_external_end_user_e164"></avp>
                </avp>
                <avp name="Subscription-Id">
                    <avp name="Subscription-Id-Type" value="1"></avp>
                    <avp name="Subscription-Id-Data" value="value_is_replaced_by_external_end_user_imsi"></avp>
                </avp>
                <avp name="Multiple-Services-Credit-Control">
                    <avp name="Requested-Service-Unit"></avp>
                    <avp name="Rating-Group" value="120"></avp>
                </avp>
                <avp name="User-Equipment-Info">
                    <avp name="User-Equipment-Info-Type" value="0"></avp>
                    <avp name="User-Equipment-Info-Value" value="value_is_replaced_by_external_imeisv"></avp>
                </avp>
                <avp name="Service-Information">
                    <avp name="PS-Information">
                        <avp name="3GPP-Charging-Id" value="0x01c40162"></avp> <!-- TODO check value changes -->
                        <avp name="3GPP-PDP-Type" value="0"></avp>
                        <avp name="PDP-Address" value="0x000100000000"></avp>
                        <avp name="3GPP-GPRS-Negotiated-QoS-Profile" value="99-13921F7196FEFE74FAFFFF"></avp>
                        <avp name="SGSN-Address" value="0x0001c990c390"></avp>
                        <avp name="GGSN-Address" value="0x0001c85fa078"></avp>
                        <avp name="3GPP-IMSI-MCC-MNC" value="000000"></avp> <!-- should be replaced by imsi part -->
                        <avp name="3GPP-GGSN-MCC-MNC" value="334020"></avp>
                        <avp name="3GPP-NSAPI" value="5"></avp>
                        <avp name="Called-Station-Id" value="wwwcorps.itelcel.com"></avp>
                        <avp name="3GPP-Selection-Mode" value="0"></avp>
                        <avp name="3GPP-Charging-Characteristics" value="3200"></avp>
                        <avp name="3GPP-SGSN-MCC-MNC" value="334020"></avp>
                        <avp name="Charging-Rule-Base-Name" value="AQ_612"></avp>
                        <avp name="3GPP-User-Location-Info" value="0x0133042032d384a4"></avp>
                        <avp name="3GPP-RAT-Type" value="0x02"></avp>
                    </avp>
                </avp>
                <avp name="Route-Record" value="0001-diamproxy.r9mlscipgw05"></avp>
            </command>
            <action>
                <start-timer></start-timer>
            </action>
        </send>

        <receive channel="channel-1">
            <action>
                <stop-timer></stop-timer>
            </action>
            <command name="CCA">
                <avp name="Result-Code" value="2001"></avp>
            </command>
            <action>
                <store name="ORIGIN_HOST" entity="Origin-Host"></store>
                <check-value name="Result-Code" behaviour="error"></check-value>
            </action>
        </receive>

        <wait-ms value="1000"></wait-ms>

        <send channel="channel-1">
            <action>
                <!-- For each new call, increment the session-ID counter -->
                <inc-counter name="HbH-counter"></inc-counter>
                <inc-counter name="EtE-counter"></inc-counter>
                <set-value name="HbH-id"
                           format="$(HbH-counter)"></set-value>
                <set-value name="EtE-id"
                           format="$(EtE-counter)"></set-value>
                <set-value name="Session-Id"
                           format="seagull.airlinq.net;1096298391;$(session-counter)"></set-value>
                <restore-from-external field="0" entity="Subscription-Id-Data" occurence="1"></restore-from-external>
                <restore-from-external field="1" entity="Subscription-Id-Data" occurence="2"></restore-from-external>
                <restore-from-external field="3" entity="User-Equipment-Info-Value"></restore-from-external>
                <restore name="ORIGIN_HOST" entity="Destination-Host"></restore>
                <restore-from-external field="0" entity="User-Name" begin="0" end="12"></restore-from-external>
                <set-value name="Event-Timestamp" method="systime"
                           format="startoffset=2208988800"></set-value>
<!--                <restore-from-external field="2" entity="PDP-Address" begin="2" end="6"></restore-from-external>-->
<!--                <restore-from-external field="1" entity="3GPP-IMSI-MCC-MNC" begin="0" end="6"></restore-from-external>-->
                <inc-var name="REQUEST_NUMBER"></inc-var>
                <restore name="REQUEST_NUMBER" entity="CC-Request-Number"></restore>
                <restore-from-external field="2" entity="Framed-IP-Address"></restore-from-external>
            </action>
            <command name="CCR">
                <avp name="Session-Id" value="value_is_replaced"></avp>
                <avp name="Origin-Host" value="seagull.airlinq.net"></avp>
                <avp name="Origin-Realm" value="airlinq.net"></avp>
                <avp name="Destination-Realm" value="epc.mnc020.mcc334.3gppnetwork.org"></avp>
                <avp name="Auth-Application-Id" value="4"></avp>
                <avp name="Service-Context-Id" value="32251@3gpp.org"></avp>
                <avp name="CC-Request-Type" value="0x00000003"></avp> <!-- TERMINATION REQUEST -->
                <avp name="CC-Request-Number" value="0"></avp> <!-- should be rewritten -->
                <avp name="Destination-Host" value="value_is replaced_by_origin_host_from_reply"></avp>
                <avp name="User-Name" value="xxxxxxxxxxxx@wwwcorps-airlinq.itelcel.com"></avp>
                <avp name="Origin-State-Id" value="1646029647"></avp>
                <avp name="Event-Timestamp" value="0"></avp> <!-- should be rewritten -->
                <avp name="Subscription-Id">
                    <avp name="Subscription-Id-Type" value="0"></avp>
                    <avp name="Subscription-Id-Data" value="value_is_replaced_by_external_end_user_e164"></avp>
                </avp>
                <avp name="Subscription-Id">
                    <avp name="Subscription-Id-Type" value="1"></avp>
                    <avp name="Subscription-Id-Data" value="value_is_replaced_by_external_end_user_imsi"></avp>
                </avp>
                <avp name="Termination-Cause" value="1"></avp> <!-- DIAMETER_LOGOUT -->
                <avp name="Multiple-Services-Credit-Control">
                    <avp name="Used-Service-Unit">
                        <avp name="CC-Time" value="1"></avp>
                        <avp name="CC-Total-Octets" value="1000000"></avp>
                        <avp name="CC-Input-Octets" value="500000"></avp>
                        <avp name="CC-Output-Octets" value="500000"></avp>
                        <avp name="CC-Service-Specific-Units" value="0"></avp>
                    </avp>
                    <avp name="Rating-Group" value="120"></avp>
                    <avp name="3GPP-Reporting-Reason" value="2"></avp> <!-- FINL -->
                </avp>
<!--                <avp name="Framed-IP-Address" value="value_is_replaced_by_external_end_user_ip_address"></avp>-->
                <avp name="User-Equipment-Info">
                    <avp name="User-Equipment-Info-Type" value="0"></avp>
                    <avp name="User-Equipment-Info-Value" value="value_is_replaced_by_external_imeisv"></avp>
                </avp>
                <avp name="Service-Information">
                    <avp name="PS-Information">
                        <avp name="3GPP-Charging-Id" value="0x01c40162"></avp> <!-- TODO check value changes -->
                        <avp name="3GPP-PDP-Type" value="0"></avp>
                        <avp name="PDP-Address" value="0x000100000000"></avp>
                        <avp name="3GPP-GPRS-Negotiated-QoS-Profile" value="99-13921F7196FEFE74FAFFFF"></avp>
                        <avp name="SGSN-Address" value="0x0001c990c390"></avp>
                        <avp name="GGSN-Address" value="0x0001c85fa078"></avp>
                        <avp name="3GPP-IMSI-MCC-MNC" value="000000"></avp> <!-- should be replaced by imsi part -->
                        <avp name="3GPP-GGSN-MCC-MNC" value="334020"></avp>
                        <avp name="3GPP-NSAPI" value="5"></avp>
                        <avp name="Called-Station-Id" value="wwwcorps.itelcel.com"></avp>
                        <avp name="3GPP-Selection-Mode" value="0"></avp>
                        <avp name="3GPP-Charging-Characteristics" value="3200"></avp>
                        <avp name="3GPP-SGSN-MCC-MNC" value="334020"></avp>
                        <avp name="Charging-Rule-Base-Name" value="AQ_612"></avp>
                        <avp name="3GPP-User-Location-Info" value="0x0133042032d384a4"></avp>
                        <avp name="3GPP-RAT-Type" value="0x02"></avp>
                    </avp>
                </avp>
                <avp name="Route-Record" value="0001-diamproxy.r9mlscipgw05"></avp>
            </command>
            <action>
                <start-timer></start-timer>
            </action>
        </send>

        <receive channel="channel-1">
            <action>
                <stop-timer></stop-timer>
            </action>
            <command name="CCA">
                <avp name="Result-Code" value="2001"></avp>
            </command>
            <action>
                <store name="ORIGIN_HOST" entity="Origin-Host"></store>
                <check-value name="Result-Code" behaviour="error"></check-value>
            </action>
        </receive>
    </traffic>

</scenario>

